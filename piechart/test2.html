<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TEST</title>
  </head>
  <body>
  <div style="max-width: 500px;">
    <canvas id="inrankPieChart"></canvas>
  </div>
  <div style="max-width: 500px;">
    <canvas id="outrankPieChart"></canvas>
  </div>

  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/chart.js-plugin-labels-dv/dist/chartjs-plugin-labels.min.js"></script>

  <script>
    // 다빈도상병(입원)

    // hoverLabel plugin block
    const hoverLabel = {
      id : 'hoverLabel',
      afterDraw(chart, args, options){
        const {ctx, chartArea: {left, right, top, bottom, width, height}} = chart;
        ctx.save();

        if(chart._active.length > 0) {
          const textLabel = chart.config.data.labels[chart._active[0].index];
          const numberLabel = chart.config.data.datasets[chart._active[0].datasetIndex].data[chart._active[0].index];
          const color = chart.config.data.datasets[chart._active[0].datasetIndex].borderColor[chart._active[0].index];

          ctx.font = 'bolder 15px Arial';
          ctx.fillStyle = color;
          ctx.textAlign = 'center';
          ctx.fillText(`${textLabel} : ${numberLabel}`, width/2, height/2+top)
        }
        ctx.restore();
      }
    }

    const inrankPieChartCtx = document.querySelector('#inrankPieChart').getContext('2d');
    const inrankPieChart = new Chart(inrankPieChartCtx, {
      type: 'doughnut',
      data: {
        labels: [
          {% for i in inrank %}
            '{{ i.disease }}'{% if not forloop.last %},{% endif %}
          {% endfor %}
        ],
        datasets: [{
          label: '입원 수 ',
          data: [
            {% for i in inrank %}
              {{ i.count }}{% if not forloop.last %},{% endif %}
            {% endfor %}
          ],
          backgroundColor: [
            'rgba(255, 26, 104, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
          ],
          borderColor: [
            'rgba(255, 26, 104, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
          ],
          borderWidth: 1,
          hoverBackgroundColor: [
            'rgba(255, 26, 104, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
          ],
          cutout: '80%'
        }]
      },
      options: {
        plugins: {
          legend: {
            display: false,
            position: 'bottom'
          },
          title: {
            display: true,
            text: '다빈도 상병(입원)'
          },
          layout: {
            padding: 10
          },
          labels: {
            render: 'percentage',
            fontColor: 'black',
            fontStyle: 'bolder',
            position: 'inside',
            textMargin: 6
          }
        }
      },
      plugins: [hoverLabel]
    });

    // 다빈도상병(외래)
    const outrankPieChartCtx = document.querySelector('#outrankPieChart').getContext('2d');
    const outrankPieChart = new Chart(outrankPieChartCtx, {
      type: 'pie',
      data: {
        labels: [
          {% for i in outrank %}
            '{{ i.disease }}'{% if not forloop.last %},{% endif %}
          {% endfor %}
        ],
        datasets: [{
          label: '외래 수 ',
          data: [
            {% for i in outrank %}
              {{ i.count }}{% if not forloop.last %},{% endif %}
            {% endfor %}
          ],
          backgroundColor: [
            'rgba(255, 26, 104, 0.2)',
            'rgba(54, 162, 235, 0.2)',
            'rgba(255, 206, 86, 0.2)',
            'rgba(75, 192, 192, 0.2)',
            'rgba(153, 102, 255, 0.2)',
          ],
          borderColor: [
            'rgba(255, 26, 104, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
          ],
          borderWidth: 1,
          hoverBackgroundColor: [
            'rgba(255, 26, 104, 1)',
            'rgba(54, 162, 235, 1)',
            'rgba(255, 206, 86, 1)',
            'rgba(75, 192, 192, 1)',
            'rgba(153, 102, 255, 1)',
          ],
          cutout: '80%'
        }]
      },
      options: {
        plugins: {
          legend: {
            display: false,
            position: 'bottom'
          },
          title: {
            display: true,
            text: '다빈도 상병(외래)'
          },
          layout: {
            padding: 10
          },
          labels: {
            render: 'percentage',
            fontColor: 'black',
            fontStyle: 'bolder',
            position: 'inside',
            textMargin: 6
          },
          tooltip: {
            callbacks: {
              display: false
            }
          }
        }
      },
      plugins: [hoverLabel]
    });
  </script>
  </body>
</html>