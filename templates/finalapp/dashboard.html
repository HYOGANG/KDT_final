{% extends 'finalapp/base.html' %}
{% block content %}
<div id="sidebar">
     <ul>
         <li>
                <div>
                    <div><a href="/board"><i class="fa-solid fa-magnifying-glass-chart"></i></a></div>
                    <div><a href="/board">main</a></div>
                </div>
         </li>
     <li>
                <div>
                    <div><a href="/map"><i class="fa-regular fa-map"></i></a></div>
                    <div><a href="/map">map</a></div>
                </div>
     </li>

     </ul>
</div>
    <div class="sejonginfo_title">
            <div class="title_name">세종특별자치시 지역정보</div>
            <div class="title_date">
                <script type="text/javascript">
                    var today = new Date();

                    var year = today.getFullYear();
                    var month = ('0' + (today.getMonth()+1)).slice(-2);
                    var day = ('0' + today.getDate()).slice(-2);

                    var dateString = year + '.' + month + '.' + day;
                    document.write("일자 : " + dateString);
                </script>
            </div>
    </div>

    <!-- 세종시 지역정보데이터 -->
    <div class="status-board">
        <div class="status-item">
            <div class="status-label">총인구수</div>
            <div class="status-value">
                    {% load humanize %}
                    {{ total_pop.total__sum | intcomma }}
        </div>
    </div>
    <div class="status-item">
        <div class="status-label">의사수</div>
        <div class="status-value">
            {% load humanize %}
                {{ doc_pop.doctor__sum | intcomma }}
        </div>
    </div>
    <div class="status-item">
        <div class="status-label">간호사수</div>
        <div class="status-value">
            {% load humanize %}
                {{ nur_pop.nurse__sum | intcomma }}
        </div>
    </div>
        <div class="status-item">
            <div class="status-label">병상수</div>
            <div class="status-value">
                 {% load humanize %}
                    {{ pat_pop.patient__sum | intcomma }}
            </div>
        </div>
    </div>

    <!-- 연령대별 인구수 데이터 전처리 -->
    <div id="pop" style="display:none">
        {% for i in table %}
            {{ i.total }}{% if not forloop.last %},{% endif %}
        {% endfor %}
    </div>
    <div id="mpop" style="display:none">
        {% for i in table %}
            {{ i.m }}{% if not forloop.last %},{% endif %}
        {% endfor %}
    </div>
    <div id="fpop" style="display: none">
        {% for j in table %}
            {{ j.f }}{% if not forloop.last %},{% endif %}
        {% endfor %}
    </div>
    <script type="text/javascript">
        var pop = document.getElementById('pop').innerText.split(',');
        var mpop = document.getElementById('mpop').innerText.split(',');
        var fpop = document.getElementById('fpop').innerText.split(',');

        var sum_0 = 0; var sum_10 = 0; var sum_20 = 0; var sum_30 = 0;
        var sum_40 = 0; var sum_50 = 0; var sum_60 = 0; var sum_70 = 0;
        var msum_0 = 0; var msum_10 = 0; var msum_20 = 0; var msum_30 = 0;
        var msum_40 = 0; var msum_50 = 0; var msum_60 = 0; var msum_70 = 0;
        var fsum_0 = 0; var fsum_10 = 0; var fsum_20 = 0; var fsum_30 = 0;
        var fsum_40 = 0; var fsum_50 = 0; var fsum_60 = 0; var fsum_70 = 0;

        for (let i=0; i<mpop.length; i++){
            if(i<10) {
                sum_0 += Number(pop[i]);
                msum_0 += Number(mpop[i]);
                fsum_0 += Number(fpop[i]);
            } else if (i<20) {
                sum_10 += Number(pop[i]);
                msum_10 += Number(mpop[i]);
                fsum_10 += Number(fpop[i]);
            } else if (i<30) {
                sum_20 += Number(pop[i]);
                msum_20 += Number(mpop[i]);
                fsum_20 += Number(fpop[i]);
            } else if (i<40) {
                sum_30 += Number(pop[i]);
                msum_30 += Number(mpop[i]);
                fsum_30 += Number(fpop[i]);
            } else if (i<50) {
                sum_40 += Number(pop[i]);
                msum_40 += Number(mpop[i]);
                fsum_40 += Number(fpop[i]);
            } else if (i<60) {
                sum_50 += Number(pop[i]);
                msum_50 += Number(mpop[i]);
                fsum_50 += Number(fpop[i]);
            } else if (i<70) {
                sum_60 += Number(pop[i]);
                msum_60 += Number(mpop[i]);
                fsum_60 += Number(fpop[i]);
            } else {
                sum_70 += Number(pop[i]);
                msum_70 += Number(mpop[i]);
                fsum_70 += Number(fpop[i]);
            }}
    </script>


    <!-- 지역정보 표 부분 -->
        <div class="sejonginfo_table">
            <!-- 연령대별 인구수 표 -->
            <div class="table1">
                <div class="table1_title">인구통계적 구성
                    <span class="table_ym">(기준년월 : 2023.09)</span>
                    <table class="table1_body">
                        <thead>
                            <tr>
                                <th>구분</th>
                                <th>인구 수</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td> 0 ~ 9세 </td>
                                <td><script type="text/javascript">document.write(sum_0.toLocaleString())</script></td>
                            </tr>
                            <tr>
                                <td> 10 ~ 19세 </td>
                                <td><script type="text/javascript">document.write(sum_10.toLocaleString())</script></td>
                            </tr>
                            <tr>
                                <td> 20 ~ 29세 </td>
                                <td><script type="text/javascript">document.write(sum_20.toLocaleString())</script></td>
                            </tr>
                            <tr>
                                <td> 30 ~ 39세 </td>
                                <td><script type="text/javascript">document.write(sum_30.toLocaleString())</script></td>
                            </tr>
                            <tr>
                                <td> 40 ~ 49세 </td>
                                <td><script type="text/javascript">document.write(sum_40.toLocaleString())</script></td>
                            </tr>
                            <tr>
                                <td> 50 ~ 59세 </td>
                                <td><script type="text/javascript">document.write(sum_50.toLocaleString())</script></td>
                            </tr>
                            <tr>
                                <td> 60 ~ 69세 </td>
                                <td><script type="text/javascript">document.write(sum_60.toLocaleString())</script></td>
                            </tr>
                            <tr>
                                <td> 70세 이상 </td>
                                <td><script type="text/javascript">document.write(sum_70.toLocaleString())</script></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>


    <!-- 차트그리기 -->
    <div class="chart-container">
        <div class="chart-box">
            <canvas id="popChart"></canvas>
        </div>
    </div>

    <script>
        // Population Chart

        Chart.defaults.font.size = 11;
        var ctxPop = document.getElementById('popChart').getContext('2d');
        var popChart = new Chart(ctxPop, {
            type: 'bar',
            data: {
                labels: ['0~9', '10~19', '20~29', '30~39', '40~49', '50~59', '60~69', '70+'],
                datasets: [
                    {
                        label: 'Male Population',
                        data: [msum_0, msum_10, msum_20, msum_30, msum_40, msum_50, msum_60, msum_70],
                        backgroundColor: 'rgba(0, 123, 255, 0.5)',
                        borderColor: 'rgba(0, 123, 255, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Female Population',
                        data: [fsum_0, fsum_10, fsum_20, fsum_30, fsum_40, fsum_50, fsum_60, fsum_70],
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                scales: {
                    x: {
                        stacked: true,
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true
                    },
                },
                plugins: {
                    title: {
                        display: true,
                        text: '인구통계',
                        padding: {
                            top: 10,
                            bottom: 10
                        }
                    }
                }
            }
        });
    </script>
    {% if d or c %}
        <div class="tables-container">
            {% if d %}
            <div class="chart_container">
                <h4 class="text-center"><u>다빈도상병(외래)</u></h4><br>
                <table class="table table-sm table-dark">
                    <thead>
                        <tr>
                            <th>rank</th>
                            <th>disease</th>
                            <th>count</th>
                            <th>percent</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in d %}
                        <tr>
                            <td>{{ i.rank }}</td>
                            <td>{{ i.disease }}</td>
                            <td>{{ i.count }}</td>
                            <td>{{ i.percent }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}

            {% if c %}
            <div class="chart_container">
                <h4 class="text-center"><u>다빈도상병(입원)</u></h4><br>
                <table class="table table-sm table-dark">
                    <thead>
                        <tr>
                            <th>rank</th>
                            <th>disease</th>
                            <th>count</th>
                            <th>percent</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in c %}
                        <tr>
                            <td>{{ i.rank }}</td>
                            <td>{{ i.disease }}</td>
                            <td>{{ i.count }}</td>
                            <td>{{ i.percent }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}