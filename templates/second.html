{% extends 'base.html' %}
{% block content %}





    <div id="chart_all" class="container-fluid row" style="margin-bottom:-0.7em; ">
        <nav class="col-md-5 p-0 mx-3">
            <div class="flex-container stretch">
                <canvas id="hpChart" class="my-2"></canvas>
            </div>
            <div>
                <canvas id="docChart"></canvas>
            </div>

        </nav>
        <div>  &emsp; </div>

        <section id="equi" class="col-md-3 mx-2 p-0" style="margin-top:0.5em;">

            {% if v %}
                <center style="margin:8px;">
                    <h8 style="color:#808080;"><b>시설 및 장비현황</b></h8><br>
                </center>
                <table class="table table-hover " style="font-size: 11px;">
                <thead>
                  <tr align="center">
                    <th>구분</th>
                    <th>세종시</th>
                    <th>전국</th>
                    <th>비율</th>
                  </tr>
                </thead>
                <tbody class="clickable-rows">
                  {% for i in v %}
                    <tr onclick="showModal('{{ i.image_path }}', '{{i.id}}')" class="clicktr">
                      <td>{{ i.device }}</td>
                      <td>{{ i.sejongsi }}</td>
                      <td>{{ i.korea }}</td>
                      <td>{{ i.percent }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
                </table>
            {% else %}
                <p>No data to display.</p>
            {% endif %}
            <div id="test2" style="display: none">
                        {% for i in test2 %}
                                {{ i.name }}|{{ i.big }}|{{ i.small }}|{{ i.count }}{% if not forloop.last %}||{% endif %}
                        {% endfor %}
            </div>
            <div id="myModal" class="modal">
                <span class="close">&times;</span>
                <div class="modal_img">
                 <img class="modal_img1" id="img01">
                <div id="caption"></div>
                </div>
                <div id="word" style="display: none;"></div>

                <div class="modal_content">
                    <table class="table" style="font-size: 11px;">
                <thead>
                  <tr align="center">
                    <th>의료시설 명</th>
                    <th>상세 분류</th>
                    <th>보유 수</th>
                  </tr>
                </thead>
                <tbody id="modalContentBody">

                </tbody>


                    </table>
                </div>

            </div>
            <script>

                var test2= document.getElementById('test2').innerHTML.split('||');

                var test2Array = test2.map(function(test22){
                    var test2Pair = test22.split('|');
                    var names = test2Pair[0];
                    var bigs = test2Pair[1];
                    var smalls = test2Pair[2];
                    var counts = test2Pair[3];


                    return [names, bigs, smalls, counts];
                });

                var modal = document.getElementById("myModal");
                var searchKeyword = '';

            // 모달에 표시될 이미지를 가져옵니다
            var modalImg = document.getElementById("img01");
            var captionText = document.getElementById("caption");

            // 이미지와 캡션 텍스트를 모달에 표시하는 함수
            function showModal(imagePath, id) {

                modal.style.display = "block";
                modalImg.src = imagePath;
                captionText.innerHTML = imagePath.split('/').pop().split('.').slice(0, -1); // 파일 이름을 캡션으로 사용

                var listS =['일반엑스선','치과용','골밀도', 'C-A', '유방촬', '치과방','전산화단층','자기공명','체외충격','혈관','감마', '방사선 ', '양전자'];
                // 여기서 id를 사용하여 검색어를 설정합니다.
                searchKeyword = listS[id];

                createDynamicTable();
            }

            // 모달의 <span> 요소 (x 버튼)를 가져옵니다
            var span = document.getElementsByClassName("close")[0];

            // x 버튼을 클릭하면 모달을 닫습니다
            span.onclick = function() {
                modal.style.display = "none";
            }

            // 동적으로 테이블 내용을 생성하는 함수
    function createDynamicTable() {
        // 테이블의 tbody 요소 가져오기
        var tbody = document.getElementById("modalContentBody");

        // tbody 초기화
        tbody.innerHTML = '';


        for (var i = 0; i < test2Array.length; i++) {
            if (  test2Array[i][1].includes(searchKeyword) ) {
                var row = tbody.insertRow();

                // 행에 셀 추가
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);

                // 각 셀에 데이터 추가
                cell1.innerHTML = test2Array[i][0]; // test2Array[0]
                cell2.innerHTML = test2Array[i][2]; // test2Array[2]
                cell3.innerHTML = test2Array[i][3]; // test2Array[3]

                cell1.classList.add("text-center");
                cell2.classList.add("text-center");
                cell3.classList.add("text-center");
            }
        }

    }

            </script>
        </section>



        <aside id="pic" class="col-md-3 mx-3 p-0 mt-2 ">
            <div class="my-2 ml-3dhk" id="map" style="width: 330px; height: 550px;">
                <div class="legend" id="legend"></div>
            <div id="test" style="display: none">
                {% for i in test %}
                    {{ i.code }}|{{ i.region }}|{{ i.hos }}|{{ i.pop }}{% if not forloop.last %},{% endif %}
                {% endfor %}
            </div>
                <div class="tooltip1" id="tooltip1"></div>
            <script>
                        // 데이터 가져오기
            var test = document.getElementById('test').innerText.split(',').map(function (test) {
                var testPair = test.split('|');
                return { code: Number(testPair[0]), region: testPair[1], hos: testPair[2], pop: testPair[3], total : Number(testPair[3]/testPair[2]) };
            });

    // 그래프 제목 추가
            const graphTitle = d3.select('#map')
                .append('div')
                .attr('class', 'graph-title')
                .text('읍면동별 인구 대비 의료시설 분포도');

    // 가상의 행정구역 경계 GeoJSON 데이터, 실제로는 서버에서 파일을 로드해야 합니다.
    const geojsonUrl = '/static/sejong.geojson';

    // 지도의 크기와 중심 좌표 설정
    const width = 400;
    const height = 550;
    const center = [127.289, 36.580]; // 조절 필요
    const scale = 60000; // 조절 필요

    // 투영 함수 설정
    const projection = d3.geoMercator()
        .center(center)
        .scale(scale)
        .translate([width / 2, height / 2]);

    // 경로 생성기 설정
    const path = d3.geoPath().projection(projection);

    // SVG 요소 생성
    const svg = d3.select('#map')
        .append('svg')
        .attr('width', width)
        .attr('height', height);


    // 범례 추가
            const legendContainer = d3.select('#pic') // 수정된 부분: #pic을 선택하도록 변경
                .append('div') // 수정된 부분: #pic 안에 div를 추가
                .attr('id', 'legend'); // 수정된 부분: id를 legend로 설정


    // 최솟값과 최댓값 설정
    const minPopulationRatio = d3.min(test, item => item.total);
    const maxPopulationRatio = d3.max(test, item => item.total);

    // 색상 스케일 동적 계산
    const colorScale = d3.scaleLinear()
        .domain([minPopulationRatio, maxPopulationRatio])
        .range(['#F4EEEE', 'RED']);

    //console.log("Min Population Ratio:", minPopulationRatio);
    //console.log("Max Population Ratio:", maxPopulationRatio);

    // 툴팁 요소 추가
    const tooltip1 = d3.select('#tooltip1');
    let selectedFeature = null;

    // 행정구역 경계를 그리기 위해 GeoJSON 데이터 로드
    d3.json(geojsonUrl).then(geojson => {
        // 행정구역 경계를 그림
        svg.selectAll('path')
            .data(geojson.features)
            .enter()
            .append('path')
            .attr('d', path)
            .attr('fill', (d, i) => {
                var jsonCode = d.properties.adm_cd; // json 파일의 코드
                var dataItem = test.find(item => item.code === Number(jsonCode));

                if (dataItem) {
                    // 일치하는 코드가 있으면 해당 행정구역에 데이터 할당
                    d.population_ratio = dataItem.total;

                    return colorScale(d.population_ratio);
                } else {
                    //console.log('Not Found:', jsonCode);
                    return '#ccc';
                }
            })
            .attr('stroke', '#000')
            .attr('stroke-width', 0.3)
            .on('click', handleFeatureClick) // 클릭 이벤트 리스너 추가
            .on('mouseout', handleMouseOut)
            .on('mouseover', handleMouseOver); // 마우스 오버 이벤트 리스너 추가

             function handleMouseOver(d, i) {
                    // 마우스를 올렸을 때 커서 스타일 변경
                    d3.select(this)
                        .style('cursor', 'pointer')
                        .attr('stroke-width', 1.5); // 테두리 두께 변경
                }

                function handleMouseOut(d, i) {
                    // 마우스가 벗어났을 때 테두리 두께 초기값으로 변경
                    d3.select(this).attr('stroke-width', 0.3);
                }

                        // 범례 제목 추가
                        legendContainer.append('div')
                            .attr('class', 'legend-title')
                            .attr('style', 'font-size:13px; white-space: nowrap; text-align:center; margin-bottom: 5px') // white-space 속성을 사용하여 텍스트가 길어져도 한 줄에 표시되도록 설정
                            .text('시설당 담당 인구(명)');

                        // 범례 내용 추가
                        const legend = legendContainer.append('div')
                            .attr('class', 'legend-item')
                            .style('display', 'flex') // Flexbox를 사용하여 가로 정렬
                            .style('align-items', 'center') // 수직 가운데 정렬
                            .style('white-space', 'nowrap'); // 텍스트가 길어져도 한 줄에 표시되도록 설정

                        // 범례 텍스트 추가 (왼쪽)
                        legend.append('div')
                            .attr('class', 'legend-text')
                            .style('margin-left', '0') // 왼쪽에 텍스트 표시
                            .style('flex-grow', '1') // 남은 공간을 모두 사용하도록 설정
                            .text(`${164}`);

                        // 그라데이션을 나타내는 가로 바 추가
                        legend.append('div')
                            .attr('class', 'legend-gradient')
                            .style('background', 'linear-gradient(to right, #F4EEEE, RED)') // 그라데이션 설정
                            .style('width', '200px') // 바의 너비 설정
                            .style('height', '20px') // 바의 높이 설정
                            .style('margin-left', '10px');



                        // 범례 텍스트 추가 (오른쪽)
                        legend.append('div')
                            .attr('class', 'legend-text')
                            .style('margin-left', '5px') // 오른쪽에 텍스트 표시
                            .style('flex', '1') // 남은 공간을 모두 사용하도록 설정
                            .style('text-align', 'right') // 오른쪽 정렬
                            .text(`${4589}`);




            function handleFeatureClick(d, i) {
                const t = test.find(item => item.code === Number(d.properties.adm_cd));

                // 클릭한 요소가 이미 선택된 경우에는 툴팁을 닫음
                if (selectedFeature === d) {
                    closeTooltip(); // 닫기 함수 호출
                } else {
                    // 클릭한 요소의 위치 가져오기
                    const [x, y] = path.centroid(d);

                    // 툴팁 내용 표시
                    const tooltipContent = `<strong>구분:</strong> ${t.region}<br><strong>의료시설 수:</strong> ${t.hos}개소 <br><strong>인구 수:</strong> ${t.pop}명 <br><strong>기관 당 담당 인구 수:</strong> ${parseInt(t.pop / t.hos)}명 `;

                    // 닫기 버튼을 추가한 툴팁 내용 표시
                    tooltip1.html(`${tooltipContent}<span class="close-tooltip" style="cursor:pointer; font-size:20px;">&times;</span>`)
                        .style('left', (x + 10) + 'px')
                        .style('top', (y - 10) + 'px')
                        .style('display', 'block');

                    selectedFeature = d; // 선택 상태 설정

                    // 닫기 버튼에 클릭 이벤트 리스너 추가
                    tooltip1.select('.close-tooltip')
                        .style('position', 'absolute')
                        .style('top', '0')
                        .style('right', '5px')
                        .on('click', closeTooltip);
                }
            }

                    // 닫기 버튼을 눌렀을 때 툴팁을 닫는 함수
                    function closeTooltip() {
                        tooltip1.style('display', 'none');
                        selectedFeature = null; // 선택 상태 해제
                    }
            // 문서 전체에 대한 클릭 이벤트 리스너 추가
            document.addEventListener('click', function (event) {
                // 클릭된 요소가 툴팁 내부에 있는지 확인
                const isClick = svg.node().contains(event.target);

                // 클릭된 요소가 툴팁 내부에 없는 경우 툴팁 닫기
                if (!isClick) {
                    closeTooltip();
                }
            });
             });

    </script>
            </div>
        </aside>
    </div>
</div>

<script>
          var coordinate = {
                  top: 0,
                  bottom : 0,
                  left : 0,
                  right : 0,
                }

         var Data = [
            {
                dep: '내과계',
                color: '#AFEEEE',
                count:{{ doctor.22.genhos|add:doctor.1.genhos|add:doctor.11.genhos|add:doctor.2.genhos|add:doctor.3.genhos|add:doctor.20.genhos|add:doctor.14.genhos|add:doctor.22.hos|add:doctor.1.hos|add:doctor.11.hos|add:doctor.2.hos|add:doctor.3.hos|add:doctor.20.hos|add:doctor.14.hos|add:doctor.22.nurs|add:doctor.1.nurs|add:doctor.11.nurs|add:doctor.2.nurs|add:doctor.3.nurs|add:doctor.20.nurs|add:doctor.14.nurs|add:doctor.22.mental|add:doctor.1.mental|add:doctor.11.mental|add:doctor.2.mental|add:doctor.3.mental|add:doctor.20.mental|add:doctor.14.mental|add:doctor.22.clinic|add:doctor.1.clinic|add:doctor.11.clinic|add:doctor.2.clinic|add:doctor.3.clinic|add:doctor.20.clinic|add:doctor.14.clinic|add:doctor.22.Public|add:doctor.1.Public|add:doctor.11.Public|add:doctor.2.Public|add:doctor.3.Public|add:doctor.20.Public|add:doctor.14.Public }},
                depData : [
                        {   dep1: '가정의학과',
                            color1: 'rgba(116, 238, 238,1)',
                            count1: {{ doctor.22.genhos|add:doctor.22.hos|add:doctor.22.nurs|add:doctor.22.mental|add:doctor.22.clinic|add:doctor.22.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.22.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.22.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.22.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.22.mental }} },
                                { dep2 : '의원', count2: {{ doctor.22.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.22.Public }} }
                            ] },

                        {   dep1: '내과',
                            color1: 'rgba(116, 238, 238, 0.9)',
                            count1: {{ doctor.1.genhos|add:doctor.1.hos|add:doctor.1.nurs|add:doctor.1.mental|add:doctor.1.clinic|add:doctor.1.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.1.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.1.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.1.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.1.mental }} },
                                { dep2 : '의원', count2: {{ doctor.1.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.1.Public }} }
                            ] },

                        {   dep1: '소아청소년과',
                            color1: 'rgba(116, 238, 238, 0.8)',
                            count1: {{ doctor.11.genhos|add:doctor.11.hos|add:doctor.11.nurs|add:doctor.11.mental|add:doctor.11.clinic|add:doctor.11.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.11.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.11.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.11.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.11.mental }} },
                                { dep2 : '의원', count2: {{ doctor.11.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.11.Public }} }
                            ] },
                        {   dep1: '신경과',
                            color1: 'rgba(116, 238, 238, 0.7)',
                            count1: {{ doctor.2.genhos|add:doctor.2.hos|add:doctor.2.nurs|add:doctor.2.mental|add:doctor.2.clinic|add:doctor.2.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.2.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.2.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.2.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.2.mental }} },
                                { dep2 : '의원', count2: {{ doctor.2.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.2.Public }} }
                            ] },
                        {   dep1: '정신건강의학과',
                            color1: 'rgba(116, 238, 238, 0.6)',
                            count1: {{ doctor.3.genhos|add:doctor.3.hos|add:doctor.3.nurs|add:doctor.3.mental|add:doctor.3.clinic|add:doctor.3.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.3.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.3.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.3.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.3.mental }} },
                                { dep2 : '의원', count2: {{ doctor.3.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.3.Public }} }
                            ] },
                        {   dep1: '재활의학과',
                            color1: 'rgba(116, 238, 238, 0.5)',
                            count1: {{ doctor.20.genhos|add:doctor.20.hos|add:doctor.20.nurs|add:doctor.20.mental|add:doctor.20.clinic|add:doctor.20.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.20.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.20.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.20.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.20.mental }} },
                                { dep2 : '의원', count2: {{ doctor.20.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.20.Public }} }
                            ] },
                       {   dep1: '피부과',
                            color1: 'rgba(116, 238, 238, 0.4)',
                            count1: {{ doctor.14.genhos|add:doctor.14.hos|add:doctor.14.nurs|add:doctor.14.mental|add:doctor.14.clinic|add:doctor.14.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.14.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.14.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.14.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.14.mental }} },
                                { dep2 : '의원', count2: {{ doctor.14.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.14.Public }} }
                            ]}
                ]},
            {
                dep: '외과계',
                color: '#95E6C9',
                count: {{ doctor.15.genhos|add:doctor.10.genhos|add:doctor.8.genhos|add:doctor.6.genhos|add:doctor.7.genhos|add:doctor.12.genhos|add:doctor.4.genhos|add:doctor.13.genhos|add:doctor.5.genhos|add:doctor.15.hos|add:doctor.10.hos|add:doctor.8.hos|add:doctor.6.hos|add:doctor.7.hos|add:doctor.12.hos|add:doctor.4.hos|add:doctor.13.hos|add:doctor.5.hos|add:doctor.15.nurs|add:doctor.10.nurs|add:doctor.8.nurs|add:doctor.6.nurs|add:doctor.7.nurs|add:doctor.12.nurs|add:doctor.4.nurs|add:doctor.13.nurs|add:doctor.5.nurs|add:doctor.15.mental|add:doctor.10.mental|add:doctor.8.mental|add:doctor.6.mental|add:doctor.7.mental|add:doctor.12.mental|add:doctor.4.mental|add:doctor.13.mental|add:doctor.5.mental|add:doctor.15.clinic|add:doctor.10.clinic|add:doctor.8.clinic|add:doctor.6.clinic|add:doctor.7.clinic|add:doctor.12.clinic|add:doctor.4.clinic|add:doctor.13.clinic|add:doctor.5.clinic|add:doctor.15.Public|add:doctor.10.Public|add:doctor.8.Public|add:doctor.6.Public|add:doctor.7.Public|add:doctor.12.Public|add:doctor.4.Public|add:doctor.13.Public|add:doctor.5.Public }},
                depData : [
                        {   dep1: '비뇨의학과',
                            color1: 'rgba(117, 226, 207, 1)',
                            count1: {{ doctor.15.genhos|add:doctor.15.hos|add:doctor.15.nurs|add:doctor.15.mental|add:doctor.15.clinic|add:doctor.15.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.15.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.15.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.15.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.15.mental }} },
                                { dep2 : '의원', count2: {{ doctor.15.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.15.Public }} }
                            ] },

                        {   dep1: '산부인과',
                            color1: 'rgba(117, 226, 207, 0.9)',
                            count1: {{ doctor.10.genhos|add:doctor.10.hos|add:doctor.10.nurs|add:doctor.10.mental|add:doctor.10.clinic|add:doctor.10.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.10.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.10.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.10.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.10.mental }} },
                                { dep2 : '의원', count2: {{ doctor.10.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.10.Public }} }
                            ] },

                        {   dep1: '성형외과',
                            color1: 'rgba(117, 226, 207, 0.8)',
                            count1: {{ doctor.8.genhos|add:doctor.8.hos|add:doctor.8.nurs|add:doctor.8.mental|add:doctor.8.clinic|add:doctor.8.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.8.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.8.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.8.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.8.mental }} },
                                { dep2 : '의원', count2: {{ doctor.8.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.8.Public }} }
                            ] },
                        {   dep1: '신경외과',
                            color1: 'rgba(117, 226, 207, 0.7)',
                            count1: {{ doctor.6.genhos|add:doctor.6.hos|add:doctor.6.nurs|add:doctor.6.mental|add:doctor.6.clinic|add:doctor.6.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.6.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.6.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.6.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.6.mental }} },
                                { dep2 : '의원', count2: {{ doctor.6.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.6.Public }} }
                            ] },
                        {   dep1: '심장혈관흉부외과',
                            color1: 'rgba(117, 226, 207, 0.6)',
                            count1: {{ doctor.7.genhos|add:doctor.7.hos|add:doctor.7.nurs|add:doctor.7.mental|add:doctor.7.clinic|add:doctor.7.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.7.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.7.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.7.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.7.mental }} },
                                { dep2 : '의원', count2: {{ doctor.7.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.7.Public }} }
                            ] },
                        {   dep1: '안과',
                            color1: 'rgba(117, 226, 207, 0.5)',
                            count1: {{ doctor.12.genhos|add:doctor.12.hos|add:doctor.12.nurs|add:doctor.12.mental|add:doctor.12.clinic|add:doctor.12.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.12.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.12.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.12.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.12.mental }} },
                                { dep2 : '의원', count2: {{ doctor.12.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.12.Public }} }
                            ] },
                        {   dep1: '외과',
                            color1: 'rgba(117, 226, 207, 0.4)',
                            count1: {{ doctor.4.genhos|add:doctor.4.hos|add:doctor.4.nurs|add:doctor.4.mental|add:doctor.4.clinic|add:doctor.4.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.4.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.4.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.4.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.4.mental }} },
                                { dep2 : '의원', count2: {{ doctor.4.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.4.Public }} }
                            ] },
                        {   dep1: '이비인후과',
                            color1: 'rgba(117, 226, 207, 0.3)',
                            count1: {{ doctor.13.genhos|add:doctor.13.hos|add:doctor.13.nurs|add:doctor.13.mental|add:doctor.13.clinic|add:doctor.13.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.13.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.13.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.13.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.13.mental }} },
                                { dep2 : '의원', count2: {{ doctor.13.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.13.Public }} }
                            ] },
                        {   dep1: '정형외과',
                            color1: 'rgba(117, 226, 207, 0.2)',
                            count1: {{ doctor.5.genhos|add:doctor.5.hos|add:doctor.5.nurs|add:doctor.5.mental|add:doctor.5.clinic|add:doctor.5.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.5.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.5.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.5.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.5.mental }} },
                                { dep2 : '의원', count2: {{ doctor.5.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.5.Public }} }
                            ] }
                ]},
            {
                dep: '지원계',
                color: '#A4A5DD',
                count: {{ doctor.9.genhos|add:doctor.17.genhos|add:doctor.18.genhos|add:doctor.16.genhos|add:doctor.23.genhos|add:doctor.24.genhos|add:doctor.19.genhos|add:doctor.21.genhos|add:doctor.9.hos|add:doctor.17.hos|add:doctor.18.hos|add:doctor.16.hos|add:doctor.23.hos|add:doctor.24.hos|add:doctor.19.hos|add:doctor.21.hos|add:doctor.9.nurs|add:doctor.17.nurs|add:doctor.18.nurs|add:doctor.16.nurs|add:doctor.23.nurs|add:doctor.24.nurs|add:doctor.19.nurs|add:doctor.21.nurs|add:doctor.9.mental|add:doctor.17.mental|add:doctor.18.mental|add:doctor.16.mental|add:doctor.23.mental|add:doctor.24.mental|add:doctor.19.mental|add:doctor.21.mental|add:doctor.9.clinic|add:doctor.17.clinic|add:doctor.18.clinic|add:doctor.16.clinic|add:doctor.23.clinic|add:doctor.24.clinic|add:doctor.19.clinic|add:doctor.21.clinic|add:doctor.9.Public|add:doctor.17.Public|add:doctor.18.Public|add:doctor.16.Public|add:doctor.23.Public|add:doctor.24.Public|add:doctor.19.Public|add:doctor.21.Public }},
                depData : [
                        {   dep1: '마취통증의학과',
                            color1: 'rgba(216, 216, 240,1)',
                            count1: {{ doctor.9.genhos|add:doctor.9.hos|add:doctor.9.nurs|add:doctor.9.mental|add:doctor.9.clinic|add:doctor.9.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.9.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.9.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.9.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.9.mental }} },
                                { dep2 : '의원', count2: {{ doctor.9.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.9.Public }} }
                            ] },

                        {   dep1: '방사선종양학과',
                            color1: 'rgba(216, 216, 240,0.9)',
                            count1: {{ doctor.17.genhos|add:doctor.17.hos|add:doctor.17.nurs|add:doctor.17.mental|add:doctor.17.clinic|add:doctor.17.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.17.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.17.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.17.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.17.mental }} },
                                { dep2 : '의원', count2: {{ doctor.17.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.17.Public }} }
                            ] },

                        {   dep1: '병리과',
                            color1: 'rgba(216, 216, 240,0.8)',
                            count1: {{ doctor.18.genhos|add:doctor.18.hos|add:doctor.18.nurs|add:doctor.18.mental|add:doctor.18.clinic|add:doctor.18.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.18.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.18.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.18.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.18.mental }} },
                                { dep2 : '의원', count2: {{ doctor.18.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.18.Public }} }
                            ] },
                        {   dep1: '영상의학과',
                            color1: 'rgba(216, 216, 240,0.7)',
                            count1: {{ doctor.16.genhos|add:doctor.16.hos|add:doctor.16.nurs|add:doctor.16.mental|add:doctor.16.clinic|add:doctor.16.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.16.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.16.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.16.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.16.mental }} },
                                { dep2 : '의원', count2: {{ doctor.16.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.16.Public }} }
                            ] },
                        {   dep1: '응급의학과',
                            color1: 'rgba(216, 216, 240, 0.6)',
                            count1: {{ doctor.23.genhos|add:doctor.23.hos|add:doctor.23.nurs|add:doctor.23.mental|add:doctor.23.clinic|add:doctor.23.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.23.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.23.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.23.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.23.mental }} },
                                { dep2 : '의원', count2: {{ doctor.23.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.23.Public }} }
                            ] },
                        {   dep1: '직업환경의학과',
                            color1: 'rgba(216, 216, 240, 0.5)',
                            count1: {{ doctor.24.genhos|add:doctor.24.hos|add:doctor.24.nurs|add:doctor.24.mental|add:doctor.24.clinic|add:doctor.24.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.24.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.24.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.24.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.24.mental }} },
                                { dep2 : '의원', count2: {{ doctor.24.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.24.Public }} }
                            ] },
                        {   dep1: '진단검사의학과',
                            color1: 'rgba(216, 216, 240, 0.4)',
                            count1: {{ doctor.19.genhos|add:doctor.19.hos|add:doctor.19.nurs|add:doctor.19.mental|add:doctor.19.clinic|add:doctor.19.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.19.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.19.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.19.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.19.mental }} },
                                { dep2 : '의원', count2: {{ doctor.19.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.19.Public }} }
                            ] },
                        {   dep1: '핵의학과',
                            color1: 'rgba(216, 216, 240, 0.3)',
                            count1: {{ doctor.21.genhos|add:doctor.21.hos|add:doctor.21.nurs|add:doctor.21.mental|add:doctor.21.clinic|add:doctor.21.Public}},
                            doctorData: [
                                { dep2 : '종합병원', count2: {{ doctor.21.genhos }} },
                                { dep2 : '병원', count2: {{ doctor.21.hos }} },
                                { dep2 : '요양병원', count2: {{ doctor.21.nurs }} },
                                { dep2 : '정신병원', count2: {{ doctor.21.mental }} },
                                { dep2 : '의원', count2: {{ doctor.21.clinic }} },
                                { dep2 : '보건지소', count2: {{ doctor.21.Public }} }
                            ] }
                ]}
        ];

        //구조 -> Data(dep, count) > depData(dep1, count1) > doctorData(dep2, count2)

        // setup 기본 데이터 설정-> data, label 자주쓰이는 config.data.datasets[0].label여기 있음
        var data = {
            datasets: [{
                label: '전문의 수(명)',
                data: Data,
                backgroundColor: [
                  Data[0].color,
                  Data[1].color,
                  Data[2].color
                ],
                borderColor: [
                  Data[0].color,
                  Data[1].color,
                  Data[2].color
                ],
                borderWidth: 2
              }]
            };

        var resetIndex = ''
           // resetButton plugin
        var resetButton = {
            id : 'resetButton',
            beforeDraw(chart, args, options){
                if(docChart.config.data.datasets[0].label !== '전문의 수(명)'){

                    var { ctx, chartArea: { top, bottom, left, right, width, height } } = chart;
                    ctx.save();

                    var text = 'Back';
                    var thickBorder = 3;
                    var textWidth = ctx.measureText(text).width;

                    // draw background
                    // ctx.fillStyle = 'rgba(255, 28, 239, 0.21)';
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                    ctx.fillRect(right - (textWidth + 1 + 10), 5, textWidth + 10 , 20)

                    // draw text
                    ctx.fillStyle = '#666';
                    ctx.font = '12px Arial';
                    ctx.fillText(text,right - (textWidth + 1 + 5), 15);


                    // draw border
                    ctx.lineWidth = thickBorder + 'px';
                    //ctx.strokeStyle = 'rgba(255,26,104,1)';
                    ctx.strokeStyle = '#E1DDE3';
                    ctx.strokeRect(right - (textWidth + 1 + 10), 5, textWidth + 10 , 20);

                    //console.log(coordinate);
                    coordinate.top = 5;
                    coordinate.bottom = 25;
                    coordinate.left = right - (textWidth + 1 + 35);
                    coordinate.right = right;

                    ctx.restore();
                };
              }
            }

        var labelList = ['진료 과별 전문의 수(명)', '내과계', '외과계', '지원계']
        var labelList1 = ['내과계', '외과계', '지원계']

        // config 구성 설정
        var config = {
            type: 'bar',
            data,
            options: {
                plugins : {
                    tooltip : {
                        yAlign : 'bottom'
                    },
                    legend : {
                        display: false
                    },
                    title:{
                        display: true,
                        text: '진료 과별 전문의 수',
                        font: {
                            size: 16,
                            weight: 'bold'
                        }
                    }
                },
                onHover: (event, chartElement) => {
                    if(labelList.includes(docChart.config.data.datasets[0].label)) {
                        event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
                    } else {
                        event.native.target.style.cursor = 'default';
                    };
                },
                parsing: {
                    xAxisKey: 'dep',
                    yAxisKey: 'count'
                },
                scales: {
                  y: {
                    beginAtZero: true
                  }
                }
            },
            plugins : [resetButton]
        };

        // render init block
        var ctx = document.getElementById('docChart');
        var docChart = new Chart(
          ctx,
          config
        );

        function changeChart(index){

            if (docChart.config.data.datasets[0].label === '전문의 수(명)') {

                docChart.config.options.parsing.xAxisKey = 'depData.dep1';
                docChart.config.options.parsing.yAxisKey = 'depData.count1';
                docChart.config.options.plugins.legend.display = true;

                var aColor = [];
                var aUsers = [];
                var aLabels = Data[index].depData.map(labels => {
                    //aColor.push(Data[index].color);
                    aColor.push(labels.color1);
                    aUsers.push(labels.count1);
                    return labels.dep1;
                })
                //console.log(aLabels);
                docChart.config.data.datasets[0].data = aUsers;
                docChart.config.data.labels = aLabels;
                docChart.config.data.datasets[0].backgroundColor = aColor;
                docChart.config.data.datasets[0].borderColor = aColor;
                docChart.config.data.datasets[0].label = Data[index].dep;
                docChart.update();
            }
        }

        var currIndex = ''
        var currIndex1 = ''

        function changeChart1(currIndex, index) {
            docChart.config.options.parsing.xAxisKey = 'doctorData.dep2';
            docChart.config.options.parsing.yAxisKey = 'doctorData.count2';
            docChart.config.options.plugins.legend.display = true;

            var bColor = [];
            var bUsers = [];
            var bLabels = Data[currIndex].depData[index].doctorData.map(labels => {
                bColor.push(Data[currIndex].depData[index].color1);
                bUsers.push(labels.count2);
                return labels.dep2;
            })
            //console.log(bLabels)
            docChart.config.data.datasets[0].data = bUsers;
            docChart.config.data.labels = bLabels;
            docChart.config.data.datasets[0].backgroundColor = bColor;
            docChart.config.data.datasets[0].borderColor = bColor;
            docChart.config.data.datasets[0].label = Data[currIndex].depData[index].dep1;
            docChart.update();
        }

        function clickHandlers(click){
            if (docChart.config.data.datasets[0].label === '전문의 수(명)'){
                var bar = docChart.getElementsAtEventForMode(click, 'nearest',
                    {intersect: true}, true);
                if(bar.length){
                    //console.log(bar[0].index);
                    changeChart(bar[0].index);
                    currIndex = bar[0].index
                }

            } else if (labelList1.includes(docChart.config.data.datasets[0].label)) {
                var bar = docChart.getElementsAtEventForMode(click, 'nearest',
                    {intersect: true}, true);
                //console.log(firstIndex);
                //console.log(bar);
                if(bar.length){
                    //console.log(bar[0].index);
                    changeChart1(currIndex, bar[0].index);
                    currIndex1 = bar[0].index
                }
            }
        };

        function resetCharts(){
            //console.log('clicked reset button!');
            //console.log(currIndex,currIndex1 );
            if (labelList1.includes(docChart.config.data.datasets[0].label)) {
                docChart.config.options.parsing.xAxisKey = 'dep';
                docChart.config.options.parsing.yAxisKey = 'count';
                docChart.config.options.plugins.legend.display = false;



                var cColor = [];
                var cCount = [];
                var cLabels = Data.map(labels => {
                  cColor.push(labels.color);
                  cCount.push(labels.count);
                  return labels.dep;
                });

                docChart.config.data.datasets[0].backgroundColor = cColor;
                docChart.config.data.datasets[0].borderColor = cColor;
                docChart.config.data.labels = cLabels;
                docChart.config.data.datasets[0].label = '전문의 수(명)';
                docChart.config.data.datasets[0].data = cCount;
                docChart.update();
            } else {
                docChart.config.options.parsing.xAxisKey = 'dep1';
                docChart.config.options.parsing.yAxisKey = 'count1';
                docChart.config.options.plugins.legend.display = true;


                var aColor = [];
                var aCount = [];
                var aLabels = Data[currIndex].depData.map(labels => {
                    aColor.push(labels.color1);
                    aCount.push(labels.count1);
                    return labels.dep1;
            });

            docChart.config.data.datasets[0].backgroundColor = aColor;
            docChart.config.data.datasets[0].borderColor = aColor;
            docChart.config.data.labels = aLabels;
            docChart.config.data.datasets[0].label = Data[currIndex].dep;
            docChart.config.data.datasets[0].data = aCount;

            docChart.update();
          }
        };


        function mousemoveHandler(canvas, mousemove) {
          var x = mousemove.offsetX;
          var y = mousemove.offsetY;

          if (!labelList.includes(docChart.config.data.datasets[0].label)){
              if ( x > coordinate.left && x < coordinate.right && y > coordinate.top && y
                   < coordinate.bottom){
                    canvas.style.cursor = 'grab';
                   } else {
                    canvas.style.cursor = 'default';
                  };
              };
          };


        function clickButtonHandler(canvas, click){
          var x = click.offsetX;
          var y = click.offsetY;

          if (x > coordinate.left && x < coordinate.right && y > coordinate.top && y
              < coordinate.bottom){
                resetCharts();
              };
        }

        ctx.onclick = clickHandlers;

        ctx.addEventListener('mousemove', (e) => {
          docChart.resize();
          mousemoveHandler(ctx, e);
        });

        ctx.addEventListener('click', (e) => {
          docChart.resize();
          clickButtonHandler(ctx,e);
        })

//---------------------------------------------------------------------------------------------------------------------------------------------------------------

        var coordinates = {
          top: 0,
          bottom : 0,
          left : 0,
          right : 0,
        }


        var browserData = [
            {
            browser: '병의원',
            color: 'rgba(0, 123, 255, 0.5)',
            marketshare: {{ cln.clinic__sum}},
            versionData: [
                {% for a in counts%}
                    { version : '{{a.region}}', users: {{a.clinic}} }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]},
            {
            browser: '보건소',
            color: 'rgba(255, 99, 132, 0.5)',
            marketshare: {{ h_c.healthcenter__sum}},
            versionData: [
                {% for a in counts%}
                    { version : '{{a.region}}', users: {{a.healthcenter}} }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]},
            {
            browser: '약국',
            color: 'rgba(75, 192, 192, 0.5)',
            marketshare: {{ pha.pharmacy__sum }},
            versionData: [
                {% for a in counts %}
                    { version : '{{ a.region }}', users: {{ a.pharmacy }} } {% if not forloop.last %},{% endif %}
                {% endfor %}
            ]},
            {
            browser: '치과',
            color: 'rgba(255, 206, 86, 0.5)',
            marketshare: {{ den.dentist__sum }},
            versionData: [
                {% for a in counts %}
                    { version : '{{a.region}}', users: {{a.dentist}} } {% if not forloop.last %},{% endif %}
                {% endfor %}
            ]},
            {
            browser: '한의원',
            color:  'rgba(153, 102, 255, 0.5)',
            marketshare: {{ ori.oriental__sum }},
            versionData: [
                {% for a in counts%}
                    { version : '{{a.region}}', users: {{a.oriental}} } {% if not forloop.last %},{% endif %}
                {% endfor %}
            ]},
        ];

        // setup
        var data = {
          datasets: [{
            label: '의료시설 수(개소)',
            data: browserData,
            backgroundColor: [
              browserData[0].color,
              browserData[1].color,
              browserData[2].color,
              browserData[3].color,
              browserData[4].color
            ],
            borderColor: [
              browserData[0].color,
              browserData[1].color,
              browserData[2].color,
              browserData[3].color,
              browserData[4].color
            ],
            borderWidth: 0.3
          }]
        };

       // resetButton plugin
        var resethpButton = {
          id : 'resethpButton',
          beforeDraw(chart, args, options){
            if(hpChart.config.data.datasets[0].label !== '의료시설 수(개소)'){

                var { ctx, chartArea: { top, bottom, left, right, width, height } } = chart;
                ctx.save();

                var text = 'Back';
                var thickBorder = 3;
                var textWidth = ctx.measureText(text).width;

                // draw background
                ctx.fillStyle = 'rgba(0,0,0,0.1)';
                ctx.fillRect(right - (textWidth + 1 + 10), 5, textWidth + 10 , 20)

                // draw text
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.fillText(text,right - (textWidth + 1 + 5), 15);

                // draw border
                ctx.lineWidth = thickBorder + 'px';
                ctx.strokeStyle = '	#E1DDE3';
                ctx.strokeRect(right - (textWidth + 1 + 10), 5, textWidth + 10 , 20);

                //console.log(coordinates)
                coordinates.top = 5;
                coordinates.bottom = 25;
                coordinates.left = right - (textWidth + 1 + 35);
                coordinates.right = right;

                ctx.restore();
            };
          }
        }

        // config
        var config = {
          type: 'bar',
          data,
          options: {
            plugins : {
              tooltip : {
                yAlign : 'bottom'
              },
              title:{
                display: true,
                text: '읍면동별 의료시설 현황',
                color : '#808080',
                font : {
                    size:16,
                    weight: 'bold',
                }
              },
              legend : {
                display: false
              }
            },
            onHover: (event, chartElement) => {
                if(hpChart.config.data.datasets[0].label === '의료시설 수(개소)')
                {
                event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
            } else {
                event.native.target.style.cursor = 'default';
            };
          },
            parsing: {
                xAxisKey: 'browser',
                yAxisKey: 'marketshare'
            },
            scales: {
              y: {
                beginAtZero: true
              }
            }
          },
          plugins : [resethpButton]
        };

        // render init block
        var ctx = document.getElementById('hpChart');
        var hpChart = new Chart(
          ctx,
          config
        );

        function changehpChart(browser){

            hpChart.config.options.parsing.xAxisKey = 'versionData.version';
            hpChart.config.options.parsing.yAxisKey = 'versionData.users';
            hpChart.config.options.plugins.legend.display = true;

            var dColor = [];
            var dUsers = [];
            var dLabels = browserData[browser].versionData.map(labels => {
                dColor.push(browserData[browser].color);
                dUsers.push(labels.users);
                return labels.version;
            })
            //console.log(dLabels)
            hpChart.config.data.datasets[0].data = dUsers;
            hpChart.config.data.labels = dLabels;
            hpChart.config.data.datasets[0].backgroundColor = dColor;
            hpChart.config.data.datasets[0].borderColor = dColor;
            hpChart.config.data.datasets[0].label = browserData[browser].browser;
            hpChart.update();
        }

        function click1Handler(click){
            if (hpChart.config.data.datasets[0].label === '의료시설 수(개소)'){

            var bar = hpChart.getElementsAtEventForMode(click, 'nearest',
                {intersect: true}, true);
            //console.log(bar);
            if(bar.length){
                //console.log(bar[0].index);
                changehpChart(bar[0].index);
            }
          }
        };

        function resethpChart(){
          // console.log('clicked reset button!');
          hpChart.config.options.parsing.xAxisKey = 'browser';
          hpChart.config.options.parsing.yAxisKey = 'marketshare';
          hpChart.config.options.plugins.legend.display = false;

          var eColor = [];
          var eMarketshare = [];
          var eLabels = browserData.map(browser => {
            eColor.push(browser.color);
            eMarketshare.push(browser.marketshare);
            return browser.browser;
          });

          hpChart.config.data.datasets[0].backgroundColor = eColor;
          hpChart.config.data.datasets[0].borderColor = eColor;
          hpChart.config.data.labels = eLabels;
          hpChart.config.data.datasets[0].label = '의료시설 수(개소)';
          hpChart.config.data.datasets[0].data = eMarketshare;
          hpChart.update();
        };


        function mousemove1Handler(canvas, mousemove ) {
          var x = mousemove.offsetX;
          var y = mousemove.offsetY;

          if(hpChart.config.data.datasets[0].label !== '의료시설 수(개소)'){
              if ( x > coordinates.left && x < coordinates.right && y > coordinates.top && y
                   < coordinates.bottom){
                    canvas.style.cursor = 'pointer';
                   } else {
                    canvas.style.cursor = 'default';
                  };
              };
          };


        function clickButton1Handler(canvas, click){
          var x = click.offsetX;
          var y = click.offsetY;

          if (x > coordinates.left && x < coordinates.right && y > coordinates.top && y
              < coordinates.bottom){
                resethpChart();
          };
        }

        ctx.onclick = click1Handler;

        ctx.addEventListener('mousemove', (e) => {
          hpChart.resize();
          mousemove1Handler(ctx, e);
        });

        ctx.addEventListener('click', (e) => {
          hpChart.resize();
          clickButton1Handler(ctx,e);
        })
    </script>


{% endblock %}
